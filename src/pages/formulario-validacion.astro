---
// src/pages/formulario-validacion.astro
---

<nav style="
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 15px 20px;
  border-radius: 0 0 15px 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  margin-bottom: 40px;
">
  <div style="
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  ">
    <!-- Logo/T√≠tulo -->
    <div style="display: flex; align-items: center; gap: 10px;">
      <div style="
        background: white;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #667eea;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      ">
        üöÄ
      </div>
      <h1 style="color: white; margin: 0; font-size: 1.5rem; font-weight: 600;">
        Astro + PostgreSQL
      </h1>
    </div>

    <!-- Men√∫ de navegaci√≥n -->
    <div style="
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    ">
      <a 
        href="/" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.3s;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(0)';"
      >
        <span>üè†</span>
        <span>Inicio</span>
      </a>
      
      <a 
        href="formulario-validacion" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.3);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 600;
          transition: all 0.3s;
          border: 2px solid rgba(255, 255, 255, 0.5);
          display: flex;
          align-items: center;
          gap: 8px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.4)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.3)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.2)';"
      >
        <span>üìù</span>
        <span>Formulario</span>
      </a>
      
      <a 
        href="error-captcha" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.3s;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(0)';"
      >
        <span>‚ö†Ô∏è</span>
        <span>Error Captcha</span>
      </a>
      
      <a 
        href="carrusel" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.3s;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(0)';"
      >
        <span>üñºÔ∏è</span>
        <span>Carrusel</span>
      </a>
    </div>
  </div>
</nav>

<div style="
  max-width: 500px;
  margin: 40px auto;
  padding: 30px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
">
  <h1 style="color: #333; text-align: center; margin-bottom: 10px;">
    üìù Formulario de Validaci√≥n
  </h1>
  <p style="color: #666; text-align: center; margin-bottom: 30px;">
    Solo validaci√≥n local - No se env√≠a a servidor
  </p>
  
  <form id="formularioValidacion">
    <!-- NOMBRE (solo letras, max 50 caracteres) -->
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
        üë§ Nombre Completo *
      </label>
      <input 
        type="text" 
        id="nombre"
        placeholder="Solo letras (m√°x. 50 caracteres)"
        style="
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 16px;
          transition: all 0.3s;
        "
        maxlength="50"
      >
      <div id="errorNombre" style="
        color: #ef4444;
        font-size: 14px;
        margin-top: 5px;
        display: none;
      "></div>
      <div style="font-size: 12px; color: #666; margin-top: 5px;">
        ‚úÖ Solo letras y espacios
      </div>
    </div>
    
    <!-- FECHA DE NACIMIENTO (calendario con l√≠mites mejorados) -->
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
        üéÇ Fecha de Nacimiento *
        <span id="edadCalculada" style="
          font-size: 12px;
          font-weight: normal;
          color: #3b82f6;
          margin-left: 10px;
        "></span>
      </label>
      <input 
        type="date" 
        id="fechaNacimiento"
        style="
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 16px;
          background: white;
        "
      >
      <div id="errorFecha" style="
        color: #ef4444;
        font-size: 14px;
        margin-top: 5px;
        display: none;
      "></div>
      <div style="font-size: 12px; color: #666; margin-top: 5px;">
        üìÖ Edad v√°lida: 18-80 a√±os
      </div>
    </div>
    
    <!-- TEL√âFONO (solo n√∫meros, exactamente 10 d√≠gitos) -->
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
        üì± Tel√©fono *
      </label>
      <input 
        type="tel" 
        id="telefono"
        placeholder="10 d√≠gitos (ej: 5512345678)"
        style="
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 16px;
          transition: all 0.3s;
        "
        maxlength="10"
      >
      <div id="errorTelefono" style="
        color: #ef4444;
        font-size: 14px;
        margin-top: 5px;
        display: none;
      "></div>
      <div style="font-size: 12px; color: #666; margin-top: 5px;">
        üî¢ Solo n√∫meros (10 d√≠gitos)
      </div>
    </div>
    
    <!-- EMAIL (validaci√≥n b√°sica) -->
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
        üìß Correo Electr√≥nico
      </label>
      <input 
        type="email" 
        id="email"
        placeholder="ejemplo@correo.com"
        style="
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 16px;
        "
      >
      <div id="errorEmail" style="
        color: #ef4444;
        font-size: 14px;
        margin-top: 5px;
        display: none;
      "></div>
    </div>
    
    <!-- BOTONES -->
    <div style="display: flex; gap: 15px; margin-top: 30px;">
      <button 
        type="button"
        id="btnValidar"
        style="
          flex: 1;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 15px;
          border: none;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(102, 126, 234, 0.4)';"
        onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
      >
        ‚úÖ Validar Formulario
      </button>
      
      <button 
        type="button"
        id="btnLimpiar"
        style="
          flex: 1;
          background: #f1f5f9;
          color: #64748b;
          padding: 15px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseenter="this.style.background='#e2e8f0';"
        onmouseleave="this.style.background='#f1f5f9';"
      >
        üóëÔ∏è Limpiar
      </button>
    </div>
    
    <!-- RESULTADO DE VALIDACI√ìN -->
    <div id="resultadoValidacion" style="
      margin-top: 25px;
      padding: 20px;
      border-radius: 10px;
      display: none;
      text-align: center;
      font-size: 16px;
    "></div>
  </form>
</div>

<script>
  // Configurar l√≠mites de fecha autom√°ticamente
  const configurarFechaLimites = () => {
    const fechaInput = document.getElementById('fechaNacimiento');
    const hoy = new Date();
    
    // M√°ximo: 18 a√±os atr√°s (edad m√≠nima 18)
    const maxFecha = new Date();
    maxFecha.setFullYear(maxFecha.getFullYear() - 18);
    
    // M√≠nimo: 80 a√±os atr√°s (edad m√°xima 80)
    const minFecha = new Date();
    minFecha.setFullYear(minFecha.getFullYear() - 80);
    
    // Formatear a YYYY-MM-DD
    fechaInput.max = maxFecha.toISOString().split('T')[0];
    fechaInput.min = minFecha.toISOString().split('T')[0];
    
    console.log('üìÖ L√≠mites de fecha configurados:');
    console.log('M√≠nimo (80 a√±os):', fechaInput.min);
    console.log('M√°ximo (18 a√±os):', fechaInput.max);
  };
  
  // Funci√≥n para calcular edad con validaci√≥n mejorada
  function calcularEdad(fechaNacimiento) {
    if (!fechaNacimiento) return null;
    
    const hoy = new Date();
    const nacimiento = new Date(fechaNacimiento);
    
    // Validar que la fecha sea v√°lida
    if (isNaN(nacimiento.getTime())) {
      return null;
    }
    
    let edad = hoy.getFullYear() - nacimiento.getFullYear();
    const mes = hoy.getMonth() - nacimiento.getMonth();
    
    if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
      edad--;
    }
    
    return edad;
  }
  
  // Funci√≥n para validar solo letras y espacios
  function validarSoloLetras(texto) {
    return /^[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√±√ë\s]+$/.test(texto);
  }
  
  // Funci√≥n para validar tel√©fono (10 d√≠gitos)
  function validarTelefono(telefono) {
    return /^\d{10}$/.test(telefono);
  }
  
  // Funci√≥n para validar email
  function validarEmail(email) {
    if (!email) return true; // Opcional
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }
  
  // Mostrar/ocultar errores
  function mostrarError(elementoId, mensaje) {
    const errorElemento = document.getElementById(`error${elementoId}`);
    const inputElemento = document.getElementById(elementoId.toLowerCase());
    
    if (errorElemento && inputElemento) {
      errorElemento.textContent = mensaje;
      errorElemento.style.display = 'block';
      inputElemento.style.borderColor = '#ef4444';
      inputElemento.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
    }
  }
  
  function limpiarError(elementoId) {
    const errorElemento = document.getElementById(`error${elementoId}`);
    const inputElemento = document.getElementById(elementoId.toLowerCase());
    
    if (errorElemento) errorElemento.style.display = 'none';
    if (inputElemento) {
      inputElemento.style.borderColor = '#10b981';
      inputElemento.style.boxShadow = '0 0 0 3px rgba(16, 185, 129, 0.1)';
    }
  }
  
  // Actualizar edad en tiempo real
  function actualizarEdadCalculada() {
    const fechaInput = document.getElementById('fechaNacimiento');
    const edadSpan = document.getElementById('edadCalculada');
    
    if (fechaInput.value) {
      const edad = calcularEdad(fechaInput.value);
      if (edad !== null) {
        edadSpan.textContent = `(${edad} a√±os)`;
        
        // Cambiar color seg√∫n edad
        if (edad < 18) {
          edadSpan.style.color = '#ef4444';
        } else if (edad > 80) {
          edadSpan.style.color = '#ef4444';
        } else {
          edadSpan.style.color = '#10b981';
        }
      }
    } else {
      edadSpan.textContent = '';
    }
  }
  
  // Evento para validar nombre en tiempo real
  document.getElementById('nombre').addEventListener('input', function(e) {
    const valor = e.target.value.trim();
    
    if (!valor) {
      limpiarError('Nombre');
      e.target.style.borderColor = '#e2e8f0';
      e.target.style.boxShadow = 'none';
      return;
    }
    
    if (!validarSoloLetras(valor)) {
      mostrarError('Nombre', 'Solo se permiten letras y espacios');
    } else if (valor.length > 50) {
      mostrarError('Nombre', 'M√°ximo 50 caracteres');
    } else {
      limpiarError('Nombre');
    }
  });
  
  // Evento para validar tel√©fono en tiempo real
  document.getElementById('telefono').addEventListener('input', function(e) {
    const valor = e.target.value.replace(/\D/g, ''); // Solo n√∫meros
    e.target.value = valor; // Forzar solo n√∫meros
    
    if (!valor) {
      limpiarError('Telefono');
      e.target.style.borderColor = '#e2e8f0';
      return;
    }
    
    if (!validarTelefono(valor)) {
      mostrarError('Telefono', 'Deben ser exactamente 10 d√≠gitos');
    } else {
      limpiarError('Telefono');
    }
  });
  
  // Evento para validar email en tiempo real
  document.getElementById('email').addEventListener('blur', function(e) {
    const valor = e.target.value.trim();
    
    if (valor && !validarEmail(valor)) {
      mostrarError('Email', 'Formato de email inv√°lido');
    } else {
      limpiarError('Email');
    }
  });
  
  // Evento para fecha de nacimiento
  document.getElementById('fechaNacimiento').addEventListener('change', function(e) {
    actualizarEdadCalculada();
    
    if (e.target.value) {
      const edad = calcularEdad(e.target.value);
      
      if (edad === null) {
        mostrarError('Fecha', 'Fecha inv√°lida');
        return;
      }
      
      if (edad < 18) {
        mostrarError('Fecha', `Debes ser mayor de 18 a√±os (tienes ${edad} a√±os)`);
      } else if (edad > 80) {
        mostrarError('Fecha', `La edad m√°xima es 80 a√±os (tienes ${edad} a√±os)`);
      } else {
        limpiarError('Fecha');
      }
    }
  });
  
  // Bot√≥n Validar
  document.getElementById('btnValidar').addEventListener('click', function() {
    const nombre = document.getElementById('nombre').value.trim();
    const fecha = document.getElementById('fechaNacimiento').value;
    const telefono = document.getElementById('telefono').value;
    const email = document.getElementById('email').value.trim();
    const resultado = document.getElementById('resultadoValidacion');
    
    let errores = [];
    
    // Validar nombre
    if (!nombre) {
      errores.push('El nombre es obligatorio');
      mostrarError('Nombre', 'El nombre es obligatorio');
    } else if (!validarSoloLetras(nombre)) {
      errores.push('Nombre: Solo letras y espacios');
      mostrarError('Nombre', 'Solo se permiten letras y espacios');
    } else if (nombre.length > 50) {
      errores.push('Nombre: M√°ximo 50 caracteres');
      mostrarError('Nombre', 'M√°ximo 50 caracteres');
    }
    
    // Validar fecha con l√≠mites mejorados
    if (!fecha) {
      errores.push('La fecha de nacimiento es obligatoria');
      mostrarError('Fecha', 'La fecha de nacimiento es obligatoria');
    } else {
      const edad = calcularEdad(fecha);
      if (edad === null) {
        errores.push('Fecha de nacimiento inv√°lida');
        mostrarError('Fecha', 'Fecha de nacimiento inv√°lida');
      } else if (edad < 18) {
        errores.push(`Debes ser mayor de 18 a√±os (tienes ${edad} a√±os)`);
        mostrarError('Fecha', `Debes ser mayor de 18 a√±os (tienes ${edad} a√±os)`);
      } else if (edad > 80) {
        errores.push(`La edad m√°xima es 80 a√±os (tienes ${edad} a√±os)`);
        mostrarError('Fecha', `La edad m√°xima es 80 a√±os (tienes ${edad} a√±os)`);
      }
    }
    
    // Validar tel√©fono
    if (!telefono) {
      errores.push('El tel√©fono es obligatorio');
      mostrarError('Telefono', 'El tel√©fono es obligatorio');
    } else if (!validarTelefono(telefono)) {
      errores.push('Tel√©fono: 10 d√≠gitos num√©ricos');
      mostrarError('Telefono', 'Deben ser exactamente 10 d√≠gitos');
    }
    
    // Validar email (opcional)
    if (email && !validarEmail(email)) {
      errores.push('Email: Formato inv√°lido');
      mostrarError('Email', 'Formato de email inv√°lido');
    }
    
    // Mostrar resultado
    resultado.style.display = 'block';
    
    if (errores.length === 0) {
      const edad = calcularEdad(fecha);
      resultado.style.background = '#d1fae5';
      resultado.style.border = '2px solid #10b981';
      resultado.innerHTML = `
        <div style="color: #065f46;">
          <h3 style="margin-top: 0;">‚úÖ ¬°Formulario V√°lido!</h3>
          <p><strong>Nombre:</strong> ${nombre}</p>
          <p><strong>Edad:</strong> ${edad} a√±os</p>
          <p><strong>Tel√©fono:</strong> ${telefono}</p>
          ${email ? `<p><strong>Email:</strong> ${email}</p>` : ''}
          <p style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">
            <em>‚ö†Ô∏è Nota: Estos datos NO se guardan en servidor</em>
          </p>
        </div>
      `;
    } else {
      resultado.style.background = '#fee2e2';
      resultado.style.border = '2px solid #ef4444';
      resultado.innerHTML = `
        <div style="color: #991b1b;">
          <h3 style="margin-top: 0;">‚ùå Errores encontrados:</h3>
          <ul style="text-align: left; padding-left: 20px;">
            ${errores.map(error => `<li>${error}</li>`).join('')}
          </ul>
          <p style="margin-top: 15px; font-size: 14px;">
            üîß <strong>Corrige los campos en rojo arriba</strong>
          </p>
        </div>
      `;
    }
    
    resultado.scrollIntoView({ behavior: 'smooth' });
  });
  
  // Bot√≥n Limpiar
  document.getElementById('btnLimpiar').addEventListener('click', function() {
    document.getElementById('formularioValidacion').reset();
    document.getElementById('resultadoValidacion').style.display = 'none';
    document.getElementById('edadCalculada').textContent = '';
    
    // Limpiar todos los errores visuales
    ['Nombre', 'Fecha', 'Telefono', 'Email'].forEach(id => {
      const errorElemento = document.getElementById(`error${id}`);
      const inputElemento = document.getElementById(id.toLowerCase());
      
      if (errorElemento) errorElemento.style.display = 'none';
      if (inputElemento) {
        inputElemento.style.borderColor = '#e2e8f0';
        inputElemento.style.boxShadow = 'none';
      }
    });
  });
  
  // Efectos visuales para inputs
  document.querySelectorAll('input').forEach(input => {
    input.addEventListener('focus', function() {
      this.style.borderColor = '#3b82f6';
      this.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.1)';
    });
    
    input.addEventListener('blur', function() {
      if (!this.style.borderColor.includes('#ef4444') && !this.style.borderColor.includes('#10b981')) {
        this.style.borderColor = '#e2e8f0';
        this.style.boxShadow = 'none';
      }
    });
  });
  
  // Inicializar cuando cargue la p√°gina
  document.addEventListener('DOMContentLoaded', function() {
    configurarFechaLimites();
    actualizarEdadCalculada();
  });
</script>