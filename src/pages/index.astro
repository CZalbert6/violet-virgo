---
// src/pages/index.astro
---

<nav style="
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 15px 20px;
  border-radius: 0 0 15px 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  margin-bottom: 40px;
">
  <div style="
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  ">
    <!-- Logo/T√≠tulo -->
    <div style="display: flex; align-items: center; gap: 10px;">
      <div style="
        background: white;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #667eea;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      ">
        üöÄ
      </div>
      <h1 style="color: white; margin: 0; font-size: 1.5rem; font-weight: 600;">
        Astro + PostgreSQL
      </h1>
    </div>

    <!-- Men√∫ de navegaci√≥n -->
    <div style="
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    ">
      <a 
        href="/" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.3);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 600;
          transition: all 0.3s;
          border: 2px solid rgba(255, 255, 255, 0.5);
          display: flex;
          align-items: center;
          gap: 8px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.4)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.3)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.2)';"
      >
        <span>üè†</span>
        <span>Inicio</span>
      </a>
      
      <a 
        href="formulario-validacion" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.3s;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(0)';"
      >
        <span>üìù</span>
        <span>Formulario</span>
      </a>
      
      <a 
        href="error-captcha" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.3s;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(0)';"
      >
        <span>‚ö†Ô∏è</span>
        <span>Error Captcha</span>
      </a>
      
      <a 
        href="carrusel" 
        style="
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.3s;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        "
        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(0)';"
      >
        <span>üñºÔ∏è</span>
        <span>Carrusel</span>
      </a>
    </div>
  </div>
</nav>

<div style="text-align: center; padding: 20px;">
  <!-- T√≠tulo principal -->
  <h1 style="font-size: 2.5rem; color: #333; margin-bottom: 10px;">
    üéØ CRUD - Mensajes PostgreSQL
  </h1>
  
  <!-- Bot√≥n para crear nuevo mensaje -->
  <button 
    id="btnAbrirModalCrear"
    style="
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 16px 32px;
      border: none;
      border-radius: 50px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 30px;
      box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    "
    onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 30px rgba(16, 185, 129, 0.4)';"
    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px rgba(16, 185, 129, 0.3)';"
  >
    <span>‚ûï</span>
    <span>Nuevo Mensaje</span>
  </button>
  
  <!-- Lista de Mensajes -->
  <div style="
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    border-top: 4px solid #8b5cf6;
  ">
    <div style="margin-bottom: 20px;">
      <div style="
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      ">
        <div style="font-size: 24px; margin-bottom: 5px;">üìã</div>
        <div style="font-weight: 600; font-size: 1.2rem;">Lista de Mensajes</div>
        <div style="font-size: 0.9rem; opacity: 0.9;">
          Total: <span id="totalMensajes">0</span> mensajes
        </div>
      </div>
      
      <!-- Controles de b√∫squeda y filtro -->
      <div style="margin-bottom: 20px;">
        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
          <input 
            type="text" 
            id="inputBuscar"
            placeholder="Buscar en mensajes..."
            style="
              flex: 1;
              min-width: 200px;
              padding: 12px 15px;
              border: 2px solid #e2e8f0;
              border-radius: 8px;
              font-size: 14px;
            "
            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)';"
            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';"
          >
        </div>
        
        <!-- Filtros -->
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
          <select 
            id="selectOrden"
            style="
              flex: 1;
              min-width: 200px;
              padding: 10px;
              border: 2px solid #e2e8f0;
              border-radius: 8px;
              font-size: 14px;
              background: white;
            "
          >
            <option value="fecha_desc">M√°s recientes primero</option>
            <option value="fecha_asc">M√°s antiguos primero</option>
            <option value="texto_asc">A-Z</option>
            <option value="texto_desc">Z-A</option>
          </select>
          
          <select 
            id="selectLimite"
            style="
              flex: 1;
              min-width: 150px;
              padding: 10px;
              border: 2px solid #e2e8f0;
              border-radius: 8px;
              font-size: 14px;
              background: white;
            "
          >
            <option value="5">5 por p√°gina</option>
            <option value="10" selected>10 por p√°gina</option>
            <option value="20">20 por p√°gina</option>
            <option value="50">50 por p√°gina</option>
          </select>
        </div>
      </div>
      
      <!-- Lista de mensajes - VERSI√ìN PROFESIONAL con altura ajustable -->
      <div id="listaMensajes" style="
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 0;
        background: #f8fafc;
        overflow: hidden;
        min-height: auto;
        height: auto;
        display: block;
      ">
        <div style="text-align: center; padding: 40px; color: #94a3b8;">
          <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>
          <p>Cargando mensajes...</p>
        </div>
      </div>
      
      <!-- Paginaci√≥n mejorada con flechas de inicio y fin -->
      <div id="paginacion" style="
        display: none;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        padding: 15px;
        background: #f1f5f9;
        border-radius: 10px;
        flex-wrap: wrap;
        gap: 5px;
      ">
        <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
          <!-- Bot√≥n ir al inicio (<<) -->
          <button 
            id="btnInicio"
            style="
              background: #3b82f6;
              color: white;
              border: none;
              width: 45px;
              height: 45px;
              border-radius: 8px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 600;
              font-size: 18px;
              transition: all 0.3s;
            "
            onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-2px)';"
            onmouseleave="this.style.background='#3b82f6'; this.style.transform='translateY(0)';"
            disabled
            title="Ir al inicio"
          >
            <span>‚èÆÔ∏è</span>
          </button>
          
          <!-- Bot√≥n anterior (<) -->
          <button 
            id="btnAnterior"
            style="
              background: #3b82f6;
              color: white;
              border: none;
              width: 45px;
              height: 45px;
              border-radius: 8px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 600;
              font-size: 18px;
              transition: all 0.3s;
            "
            onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-2px)';"
            onmouseleave="this.style.background='#3b82f6'; this.style.transform='translateY(0)';"
            disabled
            title="P√°gina anterior"
          >
            <span>‚óÄ</span>
          </button>
          
          <!-- Informaci√≥n de p√°gina -->
          <div style="
            background: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            color: #475569;
            text-align: center;
            font-weight: 500;
            min-width: 120px;
            margin: 0 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
          ">
            P√°gina <span id="paginaActual" style="font-weight: bold;">1</span> / <span id="totalPaginas" style="font-weight: bold;">1</span>
          </div>
          
          <!-- Bot√≥n siguiente (>) -->
          <button 
            id="btnSiguiente"
            style="
              background: #3b82f6;
              color: white;
              border: none;
              width: 45px;
              height: 45px;
              border-radius: 8px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 600;
              font-size: 18px;
              transition: all 0.3s;
            "
            onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-2px)';"
            onmouseleave="this.style.background='#3b82f6'; this.style.transform='translateY(0)';"
            disabled
            title="P√°gina siguiente"
          >
            <span>‚ñ∂</span>
          </button>
          
          <!-- Bot√≥n ir al final (>>) -->
          <button 
            id="btnFinal"
            style="
              background: #3b82f6;
              color: white;
              border: none;
              width: 45px;
              height: 45px;
              border-radius: 8px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 600;
              font-size: 18px;
              transition: all 0.3s;
            "
            onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-2px)';"
            onmouseleave="this.style.background='#3b82f6'; this.style.transform='translateY(0)';"
            disabled
            title="Ir al final"
          >
            <span>‚è≠Ô∏è</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Estado del sistema -->
  <div id="estadoSistema" style="
    max-width: 1200px;
    margin: 40px auto 0;
    padding: 25px;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 15px;
    border-left: 4px solid #3b82f6;
  ">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
      <div style="
        background: #3b82f6;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      ">
        üîç
      </div>
      <h3 style="margin: 0; color: #333; font-size: 1.2rem;">Estado del Sistema</h3>
    </div>
    
    <div style="margin-bottom: 10px; display: flex; align-items: center; flex-wrap: wrap; gap: 10px;">
      <strong style="color: #555; min-width: 80px;">Backend:</strong> 
      <span id="estadoTexto" style="font-size: 1rem;">Verificando...</span>
    </div>
    
    <div style="
      padding: 15px;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 8px;
      font-size: 0.9rem;
      color: #475569;
      margin-top: 15px;
    ">
      <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 18px;">üåê</span>
        <span id="backendURL" style="font-family: monospace; word-break: break-all;">...</span>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Crear Mensaje -->
<div id="modalCrear" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
">
  <div style="
    background: white;
    padding: 30px;
    border-radius: 15px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    animation: aparecer 0.3s ease-out;
  ">
    <div style="margin-bottom: 20px;">
      <div style="
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      ">
        <div style="font-size: 24px; margin-bottom: 5px;">üìù</div>
        <div style="font-weight: 600; font-size: 1.2rem;">Crear Nuevo Mensaje</div>
      </div>
      
      <label style="display: block; text-align: left; margin-bottom: 10px; font-weight: 600; color: #555;">
        Tu mensaje:
      </label>
      <input 
        type="text" 
        id="inputCrearMensaje"
        maxlength="50"
        placeholder="Escribe un mensaje... (m√°x. 50 caracteres)"
        style="width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px;"
      >
      <div style="display: flex; justify-content: flex-end; margin-top: 5px;">
        <span id="contadorCrear" style="font-size: 12px; color: #6b7280;">0/50</span>
      </div>
    </div>
    
    <div style="display: flex; gap: 15px;">
      <button 
        id="btnCrear"
        style="
          flex: 1;
          background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
          color: white; 
          padding: 16px; 
          border: none; 
          border-radius: 10px; 
          font-size: 16px; 
          font-weight: 600; 
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(16, 185, 129, 0.3)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
      >
        ‚úÖ Guardar
      </button>
      
      <button 
        id="btnCerrarModalCrear"
        style="
          flex: 1;
          background: #f1f5f9;
          color: #64748b;
          padding: 16px; 
          border: 2px solid #e2e8f0;
          border-radius: 10px; 
          font-size: 16px; 
          font-weight: 600; 
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseover="this.style.background='#e2e8f0';"
        onmouseout="this.style.background='#f1f5f9';"
      >
        ‚ùå Cancelar
      </button>
    </div>
    
    <div id="resultadoCrear" style="
      margin-top: 20px; 
      padding: 15px; 
      border-radius: 10px; 
      display: none; 
      text-align: left;
      transition: all 0.3s;
    "></div>
  </div>
</div>

<!-- Modal de Editar Mensaje -->
<div id="modalEditar" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
">
  <div style="
    background: white;
    padding: 30px;
    border-radius: 15px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    animation: aparecer 0.3s ease-out;
  ">
    <div style="margin-bottom: 20px;">
      <div style="
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      ">
        <div style="font-size: 24px; margin-bottom: 5px;">‚úèÔ∏è</div>
        <div style="font-weight: 600; font-size: 1.2rem;">Editar Mensaje</div>
      </div>
      
      <label style="display: block; text-align: left; margin-bottom: 10px; font-weight: 600; color: #555;">
        Nuevo mensaje:
      </label>
      <input 
        type="text" 
        id="inputEditarMensaje"
        maxlength="50"
        placeholder="Escribe el nuevo mensaje... (m√°x. 50 caracteres)"
        style="width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px;"
      >
      <div style="display: flex; justify-content: space-between; margin-top: 5px;">
        <span style="font-size: 12px; color: #6b7280;">Original: "<span id="mensajeOriginal"></span>"</span>
        <span id="contadorEditar" style="font-size: 12px; color: #6b7280;">0/50</span>
      </div>
    </div>
    
    <div style="display: flex; gap: 15px;">
      <button 
        id="btnActualizar"
        style="
          flex: 1;
          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
          color: white; 
          padding: 16px; 
          border: none; 
          border-radius: 10px; 
          font-size: 16px; 
          font-weight: 600; 
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(59, 130, 246, 0.3)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
      >
        ‚úÖ Actualizar
      </button>
      
      <button 
        id="btnCerrarModalEditar"
        style="
          flex: 1;
          background: #f1f5f9;
          color: #64748b;
          padding: 16px; 
          border: 2px solid #e2e8f0;
          border-radius: 10px; 
          font-size: 16px; 
          font-weight: 600; 
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseover="this.style.background='#e2e8f0';"
        onmouseout="this.style.background='#f1f5f9';"
      >
        ‚ùå Cancelar
      </button>
    </div>
    
    <div id="resultadoEditar" style="
      margin-top: 20px; 
      padding: 15px; 
      border-radius: 10px; 
      display: none; 
      text-align: left;
      transition: all 0.3s;
    "></div>
  </div>
</div>

<!-- Modal de Confirmaci√≥n para Eliminar -->
<div id="modalConfirmacion" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
">
  <div style="
    background: white;
    padding: 30px;
    border-radius: 15px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    animation: aparecer 0.3s ease-out;
  ">
    <div style="text-align: center; margin-bottom: 20px;">
      <div style="
        background: #ef4444;
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin: 0 auto 15px;
      ">
        ‚ö†Ô∏è
      </div>
      <h3 style="color: #333; margin-bottom: 10px; font-size: 1.3rem;" id="modalTitulo"></h3>
      <p style="color: #666;" id="modalMensaje"></p>
    </div>
    
    <div style="display: flex; gap: 15px;">
      <button 
        id="btnModalConfirmar"
        style="
          flex: 1;
          background: #ef4444;
          color: white;
          padding: 15px;
          border: none;
          border-radius: 8px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseover="this.style.background='#dc2626'; this.style.transform='translateY(-2px)';"
        onmouseout="this.style.background='#ef4444'; this.style.transform='translateY(0)';"
      >
        Confirmar
      </button>
      
      <button 
        id="btnModalCancelar"
        style="
          flex: 1;
          background: #f1f5f9;
          color: #64748b;
          padding: 15px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
        "
        onmouseover="this.style.background='#e2e8f0';"
        onmouseout="this.style.background='#f1f5f9';"
      >
        Cancelar
      </button>
    </div>
  </div>
</div>

<style>
  @media (max-width: 768px) {
    .contenedor-principal {
      grid-template-columns: 1fr !important;
    }
    
    .filtros-container {
      flex-direction: column !important;
    }
    
    .botones-container {
      flex-direction: column !important;
    }
    
    /* Estilos responsive para la tabla */
    .tabla-mensajes {
      display: block;
    }
    
    .tabla-mensajes thead {
      display: none;
    }
    
    .tabla-mensajes tr {
      display: block;
      margin-bottom: 15px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 15px;
    }
    
    .tabla-mensajes td {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed #e2e8f0;
    }
    
    .tabla-mensajes td:last-child {
      border-bottom: none;
    }
    
    .tabla-mensajes td::before {
      content: attr(data-label);
      font-weight: 600;
      color: #475569;
      font-size: 0.85rem;
    }
    
    .acciones-mensaje {
      justify-content: flex-end !important;
    }
  }
  
  @keyframes aparecer {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  
  .mensaje-item {
    transition: all 0.3s ease;
  }
  
  .mensaje-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
  }
  
  /* Estilos profesionales para la tabla */
  .tabla-mensajes {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
    max-height: 500px;
    overflow-y: auto;
  }
  
  .tabla-mensajes thead {
    background: #f8fafc;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .tabla-mensajes th {
    background: #f8fafc;
    padding: 16px 20px;
    text-align: left;
    color: #475569;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e2e8f0;
  }
  
  .tabla-mensajes td {
    padding: 16px 20px;
    border-bottom: 1px solid #f1f5f9;
    color: #1e293b;
  }
  
  .tabla-mensajes tr:hover td {
    background: #f8fafc;
  }
  
  .tabla-mensajes tr:last-child td {
    border-bottom: none;
  }
  
  .badge-fecha {
    background: #f1f5f9;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    color: #475569;
    display: inline-block;
    font-weight: 500;
  }
  
  .acciones-mensaje {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }
  
  .btn-accion {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }
  
  .btn-accion:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  .btn-editar {
    background: #eef2ff;
    color: #4f46e5;
  }
  
  .btn-editar:hover {
    background: #e0e7ff;
  }
  
  .btn-eliminar {
    background: #fee2e2;
    color: #ef4444;
  }
  
  .btn-eliminar:hover {
    background: #fecaca;
  }
</style>

<script>
  // ====================
  // CONFIGURACI√ìN
  // ====================
  const BACKEND_URL = 'https://violet-virgo-production.up.railway.app';
  let mensajes = [];
  let paginaActual = 1;
  let limitePorPagina = 10;
  let orden = 'fecha_desc';
  let busqueda = '';
  let mensajeAEliminar = null;
  let mensajeAEditar = null;
  
  // ====================
  // FUNCIONES PRINCIPALES
  // ====================
  
  // 1. Verificar Salud del Sistema
  async function verificarSalud() {
    const estadoTexto = document.getElementById('estadoTexto');
    const backendURL = document.getElementById('backendURL');
    backendURL.textContent = BACKEND_URL;
    
    try {
      const res = await fetch(`${BACKEND_URL}/health`);
      const data = await res.json();
      
      if (data.status === '‚úÖ OK') {
        let html = `<span style="color: #10b981; font-weight: 600;">‚úÖ Conectado</span>`;
        
        if (data.total_mensajes !== undefined) {
          html += ` | <span style="color: #3b82f6;">Mensajes: ${data.total_mensajes}</span>`;
          document.getElementById('totalMensajes').textContent = data.total_mensajes;
        }
        if (data.total_imagenes !== undefined) {
          html += ` | <span style="color: #8b5cf6;">Im√°genes: ${data.total_imagenes}</span>`;
        }
        
        estadoTexto.innerHTML = html;
      } else {
        throw new Error(data.error || 'Error desconocido');
      }
    } catch (e) {
      console.error('Error conexi√≥n backend:', e);
      estadoTexto.innerHTML = '<span style="color: #ef4444; font-weight: 600;">‚ùå Sin conexi√≥n</span>';
    }
  }
  
  // 2. Cargar Mensajes desde el backend
  async function cargarMensajes() {
    try {
      document.getElementById('listaMensajes').innerHTML = `
        <div style="text-align: center; padding: 40px; color: #94a3b8;">
          <div style="font-size: 32px; margin-bottom: 10px;">‚è≥</div>
          <p>Cargando mensajes...</p>
        </div>
      `;
      
      const respuesta = await fetch(`${BACKEND_URL}/api/mensajes`);
      
      if (!respuesta.ok) {
        throw new Error(`HTTP ${respuesta.status}: No se pudo cargar los mensajes`);
      }
      
      const data = await respuesta.json();
      
      if (data.success) {
        mensajes = data.mensajes || [];
        actualizarListaMensajes();
        actualizarPaginacion();
      } else {
        throw new Error(data.message || 'Error del servidor');
      }
    } catch (error) {
      console.error('‚ùå Error cargando mensajes:', error);
      document.getElementById('listaMensajes').innerHTML = `
        <div style="text-align: center; padding: 40px; color: #ef4444;">
          <div style="font-size: 48px; margin-bottom: 10px;">‚ùå</div>
          <p style="font-weight: 600; margin-bottom: 10px;">Error al cargar mensajes</p>
          <p style="font-size: 0.9rem; margin-bottom: 20px;">${error.message}</p>
        </div>
      `;
    }
  }
  
  // 3. Actualizar Lista de Mensajes en el DOM - VERSI√ìN PROFESIONAL
  function actualizarListaMensajes() {
    const container = document.getElementById('listaMensajes');
    
    let mensajesFiltrados = [...mensajes];
    
    if (busqueda) {
      const busquedaLower = busqueda.toLowerCase();
      mensajesFiltrados = mensajesFiltrados.filter(m => 
        m.texto.toLowerCase().includes(busquedaLower)
      );
    }
    
    mensajesFiltrados.sort((a, b) => {
      switch(orden) {
        case 'fecha_desc':
          return new Date(b.created_at) - new Date(a.created_at);
        case 'fecha_asc':
          return new Date(a.created_at) - new Date(b.created_at);
        case 'texto_asc':
          return a.texto.localeCompare(b.texto);
        case 'texto_desc':
          return b.texto.localeCompare(a.texto);
        default:
          return 0;
      }
    });
    
    const totalPaginas = Math.ceil(mensajesFiltrados.length / limitePorPagina);
    const inicio = (paginaActual - 1) * limitePorPagina;
    const fin = inicio + limitePorPagina;
    const mensajesPaginados = mensajesFiltrados.slice(inicio, fin);
    
    if (mensajesPaginados.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 60px 20px; color: #94a3b8;">
          <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
          <p style="font-size: 1.1rem; font-weight: 500; margin-bottom: 8px;">No hay mensajes para mostrar</p>
          <p style="font-size: 0.9rem;">${busqueda ? 'Intenta con otra b√∫squeda' : 'Haz clic en "Nuevo Mensaje" para crear el primero'}</p>
        </div>
      `;
      document.getElementById('paginacion').style.display = 'none';
      return;
    }
    
    // Generar tabla profesional
    let html = `
      <div style="overflow-x: auto;">
        <table class="tabla-mensajes">
          <thead>
            <tr>
              <th>MENSAJE</th>
              <th style="width: 180px;">FECHA</th>
              <th style="width: 200px; text-align: right;">ACCIONES</th>
            </tr>
          </thead>
          <tbody>
    `;
    
    mensajesPaginados.forEach((mensaje) => {
      const fecha = new Date(mensaje.created_at).toLocaleString('es-ES', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      html += `
        <tr>
          <td data-label="MENSAJE" style="max-width: 500px; word-wrap: break-word;">${mensaje.texto}</td>
          <td data-label="FECHA">
            <span class="badge-fecha">${fecha}</span>
          </td>
          <td data-label="ACCIONES" style="text-align: right;">
            <div class="acciones-mensaje">
              <button 
                class="btn-accion btn-editar"
                data-id="${mensaje.id}"
                data-texto="${mensaje.texto.replace(/"/g, '&quot;')}"
              >
                <span style="font-size: 14px;">‚úèÔ∏è</span>
                <span>Editar</span>
              </button>
              <button 
                class="btn-accion btn-eliminar"
                data-id="${mensaje.id}"
                data-texto="${mensaje.texto.replace(/"/g, '&quot;')}"
              >
                <span style="font-size: 14px;">üóëÔ∏è</span>
                <span>Eliminar</span>
              </button>
            </div>
          </td>
        </tr>
      `;
    });
    
    html += `
          </tbody>
        </table>
      </div>
    `;
    
    container.innerHTML = html;
    
    document.getElementById('totalMensajes').textContent = mensajes.length;
    
    // Agregar event listeners a los botones
    document.querySelectorAll('.btn-editar').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        const texto = this.getAttribute('data-texto');
        iniciarEdicion(id, texto);
      });
    });
    
    document.querySelectorAll('.btn-eliminar').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        const texto = this.getAttribute('data-texto');
        mostrarModalConfirmacion(id, texto);
      });
    });
  }
  
  // 4. Actualizar Paginaci√≥n - VERSI√ìN MEJORADA
  function actualizarPaginacion() {
    const paginacion = document.getElementById('paginacion');
    const paginaActualSpan = document.getElementById('paginaActual');
    const totalPaginasSpan = document.getElementById('totalPaginas');
    const btnAnterior = document.getElementById('btnAnterior');
    const btnSiguiente = document.getElementById('btnSiguiente');
    const btnInicio = document.getElementById('btnInicio');
    const btnFinal = document.getElementById('btnFinal');
    
    let mensajesFiltrados = [...mensajes];
    if (busqueda) {
      const busquedaLower = busqueda.toLowerCase();
      mensajesFiltrados = mensajesFiltrados.filter(m => 
        m.texto.toLowerCase().includes(busquedaLower)
      );
    }
    
    const totalPaginas = Math.ceil(mensajesFiltrados.length / limitePorPagina);
    
    if (totalPaginas > 1) {
      paginacion.style.display = 'flex';
      paginaActualSpan.textContent = paginaActual;
      totalPaginasSpan.textContent = totalPaginas;
      
      // Estado de los botones
      const esPrimeraPagina = paginaActual === 1;
      const esUltimaPagina = paginaActual === totalPaginas;
      
      // Botones de navegaci√≥n
      btnAnterior.disabled = esPrimeraPagina;
      btnInicio.disabled = esPrimeraPagina;
      btnSiguiente.disabled = esUltimaPagina;
      btnFinal.disabled = esUltimaPagina;
      
      // Estilos visuales para botones deshabilitados
      [btnAnterior, btnSiguiente, btnInicio, btnFinal].forEach(btn => {
        btn.style.opacity = btn.disabled ? '0.5' : '1';
        btn.style.cursor = btn.disabled ? 'default' : 'pointer';
      });
    } else {
      paginacion.style.display = 'none';
    }
  }
  
  // 5. Funciones para contadores
  function actualizarContadores() {
    const inputCrear = document.getElementById('inputCrearMensaje');
    const contadorCrear = document.getElementById('contadorCrear');
    if (inputCrear && contadorCrear) {
      inputCrear.addEventListener('input', function() {
        const length = this.value.length;
        contadorCrear.textContent = `${length}/50`;
        contadorCrear.style.color = length >= 50 ? '#ef4444' : '#6b7280';
      });
    }
    
    const inputEditar = document.getElementById('inputEditarMensaje');
    const contadorEditar = document.getElementById('contadorEditar');
    if (inputEditar && contadorEditar) {
      inputEditar.addEventListener('input', function() {
        const length = this.value.length;
        contadorEditar.textContent = `${length}/50`;
        contadorEditar.style.color = length >= 50 ? '#ef4444' : '#6b7280';
      });
    }
  }
  
  // 6. Crear Nuevo Mensaje
  async function crearMensaje() {
    const texto = document.getElementById('inputCrearMensaje').value.trim();
    
    if (!texto) {
      alert("‚ùå Por favor escribe un mensaje");
      return;
    }
    
    if (texto.length > 50) {
      alert("‚ùå El mensaje no puede tener m√°s de 50 caracteres");
      return;
    }
    
    const btnCrear = document.getElementById('btnCrear');
    const textoOriginal = btnCrear.textContent;
    btnCrear.disabled = true;
    btnCrear.textContent = 'Guardando...';
    
    try {
      const response = await fetch(`${BACKEND_URL}/api/guardar`, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ 
          texto: texto,
          hcaptcha: 'no-captcha-required'
        })
      });
      
      const data = await response.json();
      
      if (data.success) {
        mostrarResultadoModal('success', `
          <div style="display: flex; align-items: center; gap: 10px;">
            <div style="
              background: #10b981;
              color: white;
              width: 30px;
              height: 30px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">‚úì</div>
            <strong style="color: #065f46;">‚úÖ ¬°Mensaje guardado!</strong>
          </div>
        `, 'resultadoCrear');
        
        document.getElementById('inputCrearMensaje').value = '';
        document.getElementById('contadorCrear').textContent = '0/50';
        
        setTimeout(() => {
          cerrarModal('modalCrear');
          cargarMensajes();
          verificarSalud();
        }, 1500);
      } else {
        throw new Error(data.message || data.error || 'Error desconocido');
      }
    } catch (err) {
      console.error('Error creando mensaje:', err);
      mostrarResultadoModal('error', `
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="
            background: #ef4444;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
          ">‚úó</div>
          <strong style="color: #991b1b;">‚ùå Error: ${err.message}</strong>
        </div>
      `, 'resultadoCrear');
    } finally {
      btnCrear.disabled = false;
      btnCrear.textContent = textoOriginal;
    }
  }
  
  // 7. Iniciar Edici√≥n
  function iniciarEdicion(id, textoOriginal) {
    mensajeAEditar = { id, textoOriginal };
    
    document.getElementById('inputEditarMensaje').value = textoOriginal;
    document.getElementById('mensajeOriginal').textContent = textoOriginal;
    
    const contadorEditar = document.getElementById('contadorEditar');
    if (contadorEditar) {
      contadorEditar.textContent = `${textoOriginal.length}/50`;
      contadorEditar.style.color = textoOriginal.length >= 50 ? '#ef4444' : '#6b7280';
    }
    
    abrirModal('modalEditar');
  }
  
  // 8. Actualizar Mensaje
  async function actualizarMensaje() {
    const nuevoTexto = document.getElementById('inputEditarMensaje').value.trim();
    
    if (!nuevoTexto) {
      alert("‚ùå Por favor escribe el nuevo mensaje");
      return;
    }
    
    if (nuevoTexto.length > 50) {
      alert("‚ùå El mensaje no puede tener m√°s de 50 caracteres");
      return;
    }
    
    if (!mensajeAEditar) {
      return;
    }
    
    const btnActualizar = document.getElementById('btnActualizar');
    const textoOriginal = btnActualizar.textContent;
    btnActualizar.disabled = true;
    btnActualizar.textContent = 'Actualizando...';
    
    try {
      const url = `${BACKEND_URL}/api/mensajes/${mensajeAEditar.id}`;
      
      const response = await fetch(url, {
        method: 'PUT',
        headers: { 
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ 
          texto: nuevoTexto 
        })
      });
      
      const data = await response.json();
      
      if (data.success) {
        mostrarResultadoModal('success', `
          <div style="display: flex; align-items: center; gap: 10px;">
            <div style="
              background: #10b981;
              color: white;
              width: 30px;
              height: 30px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">‚úì</div>
            <strong style="color: #065f46;">‚úÖ ¬°Mensaje actualizado!</strong>
          </div>
        `, 'resultadoEditar');
        
        setTimeout(() => {
          cerrarModal('modalEditar');
          cargarMensajes();
          verificarSalud();
        }, 1500);
      } else {
        throw new Error(data.message || data.error || 'Error desconocido');
      }
    } catch (err) {
      console.error('Error actualizando mensaje:', err);
      mostrarResultadoModal('error', `
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="
            background: #ef4444;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
          ">‚úó</div>
          <strong style="color: #991b1b;">‚ùå Error: ${err.message}</strong>
        </div>
      `, 'resultadoEditar');
    } finally {
      btnActualizar.disabled = false;
      btnActualizar.textContent = textoOriginal;
    }
  }
  
  // 9. Eliminar Mensaje
  async function eliminarMensaje(id) {
    try {
      const url = `${BACKEND_URL}/api/mensajes/${id}`;
      
      const response = await fetch(url, {
        method: 'DELETE',
        headers: { 
          'Accept': 'application/json'
        }
      });
      
      const data = await response.json();
      
      if (data.success) {
        mostrarResultado('success', `
          <div style="display: flex; align-items: center; gap: 10px;">
            <div style="
              background: #10b981;
              color: white;
              width: 30px;
              height: 30px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">‚úì</div>
            <strong style="color: #065f46;">‚úÖ Mensaje eliminado</strong>
          </div>
        `, 'resultadoCrear');
        
        setTimeout(() => {
          document.getElementById('resultadoCrear').style.display = 'none';
        }, 3000);
        
        cargarMensajes();
        verificarSalud();
        
      } else {
        throw new Error(data.message || 'Error desconocido');
      }
      
    } catch (err) {
      console.error('Error eliminando mensaje:', err);
      mostrarResultado('error', `
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="
            background: #ef4444;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
          ">‚úó</div>
          <strong style="color: #991b1b;">‚ùå Error al eliminar</strong>
        </div>
      `, 'resultadoCrear');
    } finally {
      mensajeAEliminar = null;
    }
  }
  
  // 10. Funciones para modales
  function abrirModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
  }
  
  function cerrarModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
    if (modalId === 'modalEditar') {
      mensajeAEditar = null;
      document.getElementById('resultadoEditar').style.display = 'none';
    } else if (modalId === 'modalCrear') {
      document.getElementById('resultadoCrear').style.display = 'none';
    }
  }
  
  // 11. Mostrar resultado en modal
  function mostrarResultadoModal(tipo, contenido, elementoId) {
    const elemento = document.getElementById(elementoId);
    
    if (tipo === 'success') {
      elemento.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
      elemento.style.borderLeft = '4px solid #10b981';
    } else {
      elemento.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
      elemento.style.borderLeft = '4px solid #ef4444';
    }
    
    elemento.innerHTML = contenido;
    elemento.style.display = 'block';
  }
  
  // 12. Mostrar resultado en lista
  function mostrarResultado(tipo, contenido, elementoId) {
    const elemento = document.getElementById(elementoId);
    
    if (tipo === 'success') {
      elemento.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
      elemento.style.borderLeft = '4px solid #10b981';
    } else {
      elemento.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
      elemento.style.borderLeft = '4px solid #ef4444';
    }
    
    elemento.innerHTML = contenido;
    elemento.style.display = 'block';
  }
  
  // 13. Mostrar Modal de Confirmaci√≥n para Eliminar
  function mostrarModalConfirmacion(id, texto) {
    mensajeAEliminar = id;
    
    const modal = document.getElementById('modalConfirmacion');
    const titulo = document.getElementById('modalTitulo');
    const mensaje = document.getElementById('modalMensaje');
    
    titulo.textContent = '¬øEliminar Mensaje?';
    mensaje.innerHTML = `
      Est√°s a punto de eliminar este mensaje<br><br>
      <div style="
        background: #fee2e2;
        padding: 10px;
        border-radius: 6px;
        border-left: 3px solid #ef4444;
        margin: 10px 0;
        font-size: 0.9rem;
      ">
        "${texto.substring(0, 100)}${texto.length > 100 ? '...' : ''}"
      </div>
      <span style="color: #ef4444; font-weight: 600; font-size: 0.9rem;">Esta acci√≥n no se puede deshacer.</span>
    `;
    
    modal.style.display = 'flex';
  }
  
  // 14. Ocultar Modal de Confirmaci√≥n
  function ocultarModalConfirmacion() {
    document.getElementById('modalConfirmacion').style.display = 'none';
    mensajeAEliminar = null;
  }
  
  // ====================
  // EVENT LISTENERS
  // ====================
  
  document.addEventListener('DOMContentLoaded', function() {
    // Inicializar contadores
    actualizarContadores();
    
    // Inicializar
    verificarSalud();
    cargarMensajes();
    
    // Event Listeners para modales
    document.getElementById('btnAbrirModalCrear').addEventListener('click', () => abrirModal('modalCrear'));
    
    document.getElementById('btnCerrarModalCrear').addEventListener('click', () => cerrarModal('modalCrear'));
    
    document.getElementById('btnCerrarModalEditar').addEventListener('click', () => cerrarModal('modalEditar'));
    
    // Cerrar modales haciendo clic fuera
    document.getElementById('modalCrear').addEventListener('click', function(e) {
      if (e.target === this) {
        cerrarModal('modalCrear');
      }
    });
    
    document.getElementById('modalEditar').addEventListener('click', function(e) {
      if (e.target === this) {
        cerrarModal('modalEditar');
      }
    });
    
    document.getElementById('modalConfirmacion').addEventListener('click', function(e) {
      if (e.target === this) {
        ocultarModalConfirmacion();
      }
    });
    
    // Crear mensaje
    document.getElementById('btnCrear').addEventListener('click', crearMensaje);
    
    // Actualizar mensaje
    document.getElementById('btnActualizar').addEventListener('click', actualizarMensaje);
    
    // B√∫squeda
    const inputBuscar = document.getElementById('inputBuscar');
    inputBuscar.addEventListener('input', function(e) {
      clearTimeout(this.timer);
      this.timer = setTimeout(() => {
        busqueda = e.target.value;
        paginaActual = 1;
        actualizarListaMensajes();
        actualizarPaginacion();
      }, 500);
    });
    
    // Orden
    document.getElementById('selectOrden').addEventListener('change', function(e) {
      orden = e.target.value;
      paginaActual = 1;
      actualizarListaMensajes();
      actualizarPaginacion();
    });
    
    // L√≠mite por p√°gina
    document.getElementById('selectLimite').addEventListener('change', function(e) {
      limitePorPagina = parseInt(e.target.value);
      paginaActual = 1;
      actualizarListaMensajes();
      actualizarPaginacion();
    });
    
    // Paginaci√≥n - Botones existentes
    document.getElementById('btnAnterior').addEventListener('click', function() {
      if (paginaActual > 1) {
        paginaActual--;
        actualizarListaMensajes();
        actualizarPaginacion();
      }
    });
    
    document.getElementById('btnSiguiente').addEventListener('click', function() {
      paginaActual++;
      actualizarListaMensajes();
      actualizarPaginacion();
    });
    
    // Nuevos botones de paginaci√≥n (inicio y final)
    document.getElementById('btnInicio').addEventListener('click', function() {
      if (paginaActual > 1) {
        paginaActual = 1;
        actualizarListaMensajes();
        actualizarPaginacion();
      }
    });
    
    document.getElementById('btnFinal').addEventListener('click', function() {
      let mensajesFiltrados = [...mensajes];
      if (busqueda) {
        const busquedaLower = busqueda.toLowerCase();
        mensajesFiltrados = mensajesFiltrados.filter(m => 
          m.texto.toLowerCase().includes(busquedaLower)
        );
      }
      const totalPaginas = Math.ceil(mensajesFiltrados.length / limitePorPagina);
      
      if (paginaActual < totalPaginas) {
        paginaActual = totalPaginas;
        actualizarListaMensajes();
        actualizarPaginacion();
      }
    });
    
    // Modal de confirmaci√≥n
    document.getElementById('btnModalConfirmar').addEventListener('click', function() {
      if (mensajeAEliminar) {
        eliminarMensaje(mensajeAEliminar);
      }
      ocultarModalConfirmacion();
    });
    
    document.getElementById('btnModalCancelar').addEventListener('click', ocultarModalConfirmacion);
    
    // Enter en inputs
    document.getElementById('inputCrearMensaje').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        crearMensaje();
      }
    });
    
    document.getElementById('inputEditarMensaje').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        actualizarMensaje();
      }
    });
    
    // Cerrar modal con ESC
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        cerrarModal('modalCrear');
        cerrarModal('modalEditar');
        ocultarModalConfirmacion();
      }
    });
    
    // Hacer responsive
    function hacerResponsive() {
      const listaMensajes = document.getElementById('listaMensajes');
      if (window.innerWidth < 768) {
        if (listaMensajes) {
          listaMensajes.style.gridTemplateColumns = '1fr';
        }
      } else {
        if (listaMensajes) {
          listaMensajes.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
        }
      }
    }
    
    window.addEventListener('resize', hacerResponsive);
    hacerResponsive();
  });
</script>